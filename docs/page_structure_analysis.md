# ページ構造分析: 利用者管理 vs 利用者詳細

## 現状の2ページ比較

### 1. 利用者管理ページ (`1_👤_User_Management.py`)

**主な機能:**
- ✅ 利用者一覧表示（検索・フィルタリング）
- ✅ 新規利用者登録フォーム
- ✅ 利用者編集フォーム
- ✅ 利用者詳細表示（詳細アイコンクリック時）
  - 基本情報
  - 手帳情報
  - アセスメント履歴（テーブル表示）
  - 支援計画履歴（テーブル表示）
  - アクションボタン（編集、アセスメント実施、計画作成、モニタリング）

**特徴:**
- **CRUD操作中心**: 登録・編集・削除がメイン
- **一覧からの遷移**: 検索 → 選択 → 詳細表示 → 編集/操作
- **管理者向けUI**: 効率的なデータ管理重視

---

### 2. 利用者詳細ページ (`5_👤_User_Detail.py`)

**主な機能:**
- ✅ 利用者選択（ドロップダウン）
- ✅ 詳細情報表示ボタンで展開
  - 🚨 アラート表示（期限警告等）
  - 基本情報（4カラムメトリクス表示）
  - 手帳情報（期限警告付き）
  - 🏢 現在利用中のサービス（展開可能カード）
  - 📊 直近のモニタリング結果（詳細展開可能）
  - 🎯 目標達成状況（プログレスバー表示）
  - 📅 支援タイムライン（時系列表示）

**特徴:**
- **ダッシュボード形式**: 視覚的に情報を統合表示
- **支援状況の可視化**: 目標達成率、サービス評価、タイムライン
- **アラート機能**: 期限切れや要対応事項の強調
- **支援者向けUI**: 包括的な支援状況の把握重視

---

## 主な違い

| 項目 | 利用者管理 | 利用者詳細 |
|-----|-----------|-----------|
| **目的** | データ管理・編集 | 支援状況把握 |
| **対象者** | 管理者・事務スタッフ | 相談支援専門員 |
| **表示形式** | テーブル中心 | カード・メトリクス |
| **アラート** | なし | 🚨 期限警告表示 |
| **目標進捗** | 件数のみ | プログレスバー |
| **サービス情報** | なし | 詳細表示 |
| **タイムライン** | なし | 時系列表示 |
| **編集機能** | ✅ あり | ❌ なし |

---

## 統合か分離か：検討ポイント

### 🔄 統合案（利用者管理に統合）

**メリット:**
- ページ数削減でナビゲーションがシンプル
- 1ページで管理と閲覧を完結
- コード重複の削減

**デメリット:**
- ページが肥大化・複雑化
- 管理機能と閲覧機能が混在
- ユーザー目的別の最適化が困難

### ✨ 分離維持案（現状維持で改善）

**メリット:**
- 目的別に最適化されたUI
- 管理者と支援者で使い分け可能
- ページごとの責任が明確

**デメリット:**
- ページ数が多くなる
- 一部機能の重複

---

## 推奨：分離維持 + 役割明確化

### 理由

1. **ユーザーの役割が異なる**
   - 管理ページ: 事務スタッフ・管理者向け（データ入力・編集）
   - 詳細ページ: 相談支援専門員向け（支援状況確認・意思決定）

2. **情報の見せ方が異なる**
   - 管理: テーブル・フォーム中心
   - 詳細: ダッシュボード・可視化中心

3. **将来の拡張性**
   - 詳細ページにエコマップ、支援経過記録等を追加予定
   - 管理ページは CRUD 機能に特化

### 改善提案

#### 利用者管理ページ (`1_👤_User_Management.py`)
- ✅ pandas import 追加（完了）
- ✅ 手帳情報表示追加（完了）
- 📌 詳細表示を簡素化
  - アセスメント・計画は件数のみ表示
  - 「詳細を見る」ボタンで User Detail ページに遷移

#### 利用者詳細ページ (`5_👤_User_Detail.py`)
- 📌 利用者管理ページからの直接遷移を追加
- 📌 エコマップ表示機能を追加（将来）
- 📌 支援経過記録を追加（将来）

### 実装例：遷移ボタン追加

```python
# 利用者管理ページの詳細表示に追加
with col4:
    if st.button("詳細ダッシュボード →", use_container_width=True):
        st.session_state["selected_user_id"] = user_id
        st.switch_page("pages/5_👤_User_Detail.py")
```

---

## まとめ

**結論**: 2つのページは分離維持が望ましい

**次のアクション:**
1. ✅ pandas import 修正（完了）
2. ✅ 手帳情報表示追加（完了）
3. 📌 利用者管理ページに「詳細ダッシュボード」ボタンを追加
4. 📌 User Detail ページを相談支援専門員向けに最適化
5. 📌 将来的にエコマップ・経過記録を User Detail に追加

**想定ワークフロー:**
```
[利用者管理]
  ├─ 登録・編集 → ここで完結
  ├─ 基本情報確認 → ここで完結
  └─ 詳細な支援状況 → 詳細ダッシュボードへ遷移

[利用者詳細]
  ├─ アラート確認
  ├─ 目標達成状況確認
  ├─ サービス利用状況確認
  └─ 支援履歴確認
```
