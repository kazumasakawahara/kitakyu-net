# Implementation Tasks: Facility Search AI Assistant

## 1. 環境セットアップ

### 1.1 Ollama インストールと設定
- [ ] 1.1.1 Ollama をインストール（https://ollama.ai）
- [ ] 1.1.2 推奨LLMモデルをプル (`ollama pull qwen2.5:7b`)
- [ ] 1.1.3 Ollama サーバー起動確認 (`ollama serve`)
- [ ] 1.1.4 動作テスト (`ollama run qwen2.5:7b "こんにちは"`)

### 1.2 Neo4j 接続確認
- [ ] 1.2.1 Neo4j Desktop で disability-support インスタンス起動
- [ ] 1.2.2 新規データベース作成（例: `kitakyu-facilities`）
- [ ] 1.2.3 接続情報を `.env` に設定
- [ ] 1.2.4 Python neo4j ドライバーで接続テスト

### 1.3 Python 依存関係インストール
- [ ] 1.3.1 `requirements.txt` 更新（新規パッケージ追加）
- [ ] 1.3.2 仮想環境で `uv pip install -r requirements.txt`
- [ ] 1.3.3 インポートテスト（全パッケージ）

## 2. データ取得・処理パイプライン

### 2.1 WAM NET スクレイパー実装
- [ ] 2.1.1 `scripts/01_wamnet_scraper.py` 作成
- [ ] 2.1.2 WAM NET から北九州市データ手動ダウンロード
- [ ] 2.1.3 CSV 読み込みロジック実装
- [ ] 2.1.4 サービス種別ごとのデータ取得
- [ ] 2.1.5 エラーハンドリング実装
- [ ] 2.1.6 ロギング実装

### 2.2 データ処理スクリプト実装
- [ ] 2.2.1 `scripts/02_data_processor.py` 作成
- [ ] 2.2.2 データ検証ロジック（必須項目チェック）
- [ ] 2.2.3 データ正規化（郵便番号、電話番号等）
- [ ] 2.2.4 UUID 生成ロジック
- [ ] 2.2.5 重複検出・マージロジック
- [ ] 2.2.6 テストデータで動作確認

### 2.3 Neo4j インポート実装
- [ ] 2.3.1 `scripts/03_neo4j_importer.py` 作成
- [ ] 2.3.2 Neo4j スキーマ定義（制約、インデックス）
- [ ] 2.3.3 Facility ノード作成ロジック
- [ ] 2.3.4 バッチインポート実装（効率化）
- [ ] 2.3.5 更新モード実装（既存データとの差分）
- [ ] 2.3.6 データ検証クエリ実装

## 3. バックエンド実装

### 3.1 プロジェクト構造作成
- [ ] 3.1.1 `backend/` ディレクトリ構造作成
- [ ] 3.1.2 `backend/config.py` 設定ファイル作成
- [ ] 3.1.3 `.env` テンプレート更新

### 3.2 Neo4j クライアント実装
- [ ] 3.2.1 `backend/neo4j/client.py` 作成
- [ ] 3.2.2 接続プール管理
- [ ] 3.2.3 `backend/neo4j/queries.py` Cypher クエリ定義
- [ ] 3.2.4 検索関数実装（サービス種別、地域、条件等）
- [ ] 3.2.5 エラーハンドリング実装

### 3.3 Ollama クライアント実装
- [ ] 3.3.1 `backend/llm/ollama_client.py` 作成
- [ ] 3.3.2 HTTP API ラッパー実装
- [ ] 3.3.3 ストリーミング対応（リアルタイム出力）
- [ ] 3.3.4 タイムアウト・リトライ実装
- [ ] 3.3.5 プロンプトテンプレート管理

### 3.4 RAG パイプライン実装
- [ ] 3.4.1 `backend/llm/rag_pipeline.py` 作成
- [ ] 3.4.2 クエリ解析ロジック（LLM）
- [ ] 3.4.3 Neo4j 検索統合
- [ ] 3.4.4 コンテキスト構築ロジック
- [ ] 3.4.5 回答生成ロジック
- [ ] 3.4.6 プロンプト最適化

### 3.5 FastAPI 実装
- [ ] 3.5.1 `backend/api/main.py` 作成
- [ ] 3.5.2 API エンドポイント定義
- [ ] 3.5.3 `backend/api/routes/chat.py` チャットエンドポイント
- [ ] 3.5.4 `backend/api/routes/facilities.py` 事業所検索API
- [ ] 3.5.5 `backend/api/models/schemas.py` データスキーマ定義
- [ ] 3.5.6 CORS 設定（Streamlit 連携用）
- [ ] 3.5.7 API ドキュメント確認（/docs）

## 4. フロントエンド実装

### 4.1 Streamlit アプリ実装
- [ ] 4.1.1 `frontend/streamlit_app.py` 作成
- [ ] 4.1.2 基本レイアウト設定
- [ ] 4.1.3 チャット画面実装（st.chat_message）
- [ ] 4.1.4 会話履歴管理（st.session_state）
- [ ] 4.1.5 FastAPI バックエンド連携
- [ ] 4.1.6 検索結果表示（表形式 + 詳細）
- [ ] 4.1.7 ローディング表示
- [ ] 4.1.8 エラーハンドリング・メッセージ

### 4.2 UI/UX 改善
- [ ] 4.2.1 日本語フォント設定
- [ ] 4.2.2 サンプル質問ボタン追加
- [ ] 4.2.3 検索結果フィルター（地域、サービス種別）
- [ ] 4.2.4 事業所詳細モーダル
- [ ] 4.2.5 レスポンシブデザイン確認

## 5. 統合テスト

### 5.1 データフロー確認
- [ ] 5.1.1 WAM NET → データ処理 → Neo4j 全体テスト
- [ ] 5.1.2 データ品質検証（必須項目、正規化）
- [ ] 5.1.3 重複データ検出テスト

### 5.2 機能テスト
- [ ] 5.2.1 自然言語検索テスト（10パターン以上）
- [ ] 5.2.2 複雑な条件検索テスト
- [ ] 5.2.3 該当なしケースのハンドリング確認
- [ ] 5.2.4 エラーケースのハンドリング確認

### 5.3 パフォーマンステスト
- [ ] 5.3.1 検索レスポンス時間計測（目標: <5秒）
- [ ] 5.3.2 LLM推論時間計測
- [ ] 5.3.3 Neo4j クエリ最適化

### 5.4 ユーザビリティテスト
- [ ] 5.4.1 実務担当者によるテスト
- [ ] 5.4.2 フィードバック収集
- [ ] 5.4.3 改善点の洗い出し

## 6. ドキュメント整備

### 6.1 セットアップガイド
- [ ] 6.1.1 環境構築手順書作成（Ollama, Neo4j, Python）
- [ ] 6.1.2 トラブルシューティングガイド作成
- [ ] 6.1.3 FAQ 作成

### 6.2 運用ドキュメント
- [ ] 6.2.1 データ更新手順書作成
- [ ] 6.2.2 バックアップ手順書作成
- [ ] 6.2.3 システム監視ポイント定義

### 6.3 ユーザーガイド
- [ ] 6.3.1 基本操作マニュアル作成
- [ ] 6.3.2 検索のコツ・サンプル集作成
- [ ] 6.3.3 スクリーンショット付きガイド

## 7. デプロイと本番環境準備

### 7.1 本番環境設定
- [ ] 7.1.1 `.env.production` 作成
- [ ] 7.1.2 ログ設定（本番用）
- [ ] 7.1.3 エラー通知設定

### 7.2 起動スクリプト作成
- [ ] 7.2.1 バックエンド起動スクリプト
- [ ] 7.2.2 フロントエンド起動スクリプト
- [ ] 7.2.3 一括起動スクリプト（dev/prod）

### 7.3 最終確認
- [ ] 7.3.1 全機能の動作確認
- [ ] 7.3.2 セキュリティチェック（API認証等）
- [ ] 7.3.3 本番環境での動作確認

## Notes

- 各タスクは順序通りに実施推奨（依存関係あり）
- 1.1-1.3 は並行実施可能
- 3.2-3.3 は並行実施可能
- 問題が発生した場合は design.md の Open Questions を参照
- テストは各フェーズで実施（単体 → 統合）
