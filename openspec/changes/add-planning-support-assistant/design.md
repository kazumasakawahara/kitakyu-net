# Design: Planning Support AI Assistant

## Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Streamlit Frontend                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ æ–½è¨­æ¤œç´¢   â”‚ åˆ©ç”¨è€…ç®¡ç†    â”‚ ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆãƒ»è¨ˆç”»æ›¸ â”‚ â”‚
â”‚  â”‚ (æ—¢å­˜)     â”‚ (æ–°è¦)        â”‚ (æ–°è¦)                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“ HTTP REST API
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   FastAPI Backend                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ /search    â”‚ /users        â”‚ /plans               â”‚ â”‚
â”‚  â”‚ /facilitiesâ”‚ /assessments  â”‚ /documents           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“                    â†“                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Neo4j Graph  â”‚    â”‚ Ollama LLM       â”‚    â”‚ Document    â”‚
â”‚ Database     â”‚    â”‚ (gpt-oss:20b)    â”‚    â”‚ Generator   â”‚
â”‚              â”‚    â”‚                  â”‚    â”‚ (docx/pdf)  â”‚
â”‚ Facility     â”‚    â”‚ Needs Analysis   â”‚    â”‚             â”‚
â”‚ User         â”‚    â”‚ Goal Setting     â”‚    â”‚ Form1/Form5 â”‚
â”‚ Plan         â”‚    â”‚ Service Planning â”‚    â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Model Extensions

### Neo4j Schema

```cypher
// ============================================================
// User (åˆ©ç”¨è€…) ãƒãƒ¼ãƒ‰
// ============================================================
CREATE CONSTRAINT user_id_unique IF NOT EXISTS
FOR (u:User) REQUIRE u.user_id IS UNIQUE;

// User properties
(u:User {
  user_id: string,              // UUID
  name: string,                 // æ°å
  kana: string,                 // ãƒ•ãƒªã‚¬ãƒŠ
  birth_date: date,             // ç”Ÿå¹´æœˆæ—¥
  age: integer,                 // å¹´é½¢ï¼ˆè¨ˆç®—ï¼‰
  gender: string,               // æ€§åˆ¥
  disability_type: string,      // éšœå®³ç¨®åˆ¥ï¼ˆçŸ¥çš„/ç²¾ç¥/èº«ä½“/é›£ç—…ï¼‰
  disability_grade: string,     // éšœå®³ç­‰ç´š
  support_level: string,        // éšœå®³æ”¯æ´åŒºåˆ†ï¼ˆ1-6ï¼‰
  therapy_notebook: boolean,    // ç™‚è‚²æ‰‹å¸³ã®æœ‰ç„¡
  medical_care_needs: boolean,  // åŒ»ç™‚çš„ã‚±ã‚¢
  behavioral_support_needs: boolean, // å¼·åº¦è¡Œå‹•éšœå®³
  living_situation: string,     // å±…ä½çŠ¶æ³ï¼ˆåœ¨å®…/å…¥æ‰€/GHç­‰ï¼‰
  family_structure: string,     // å®¶æ—æ§‹æˆ
  guardian_name: string,        // ä¿è­·è€…å
  guardian_relation: string,    // ç¶šæŸ„
  contact_phone: string,        // é€£çµ¡å…ˆ
  contact_address: string,      // ä½æ‰€
  created_at: datetime,
  updated_at: datetime
})

// ============================================================
// Plan (ã‚µãƒ¼ãƒ“ã‚¹ç­‰åˆ©ç”¨è¨ˆç”») ãƒãƒ¼ãƒ‰
// ============================================================
CREATE CONSTRAINT plan_id_unique IF NOT EXISTS
FOR (p:Plan) REQUIRE p.plan_id IS UNIQUE;

(p:Plan {
  plan_id: string,              // UUID
  plan_number: string,          // è¨ˆç”»æ›¸ç•ªå·
  plan_type: string,            // ã€Œåˆå›ã€ã€Œç¶™ç¶šã€ã€Œè¦‹ç›´ã—ã€
  plan_date: date,              // ä½œæˆæ—¥
  plan_period_start: date,      // è¨ˆç”»æœŸé–“é–‹å§‹
  plan_period_end: date,        // è¨ˆç”»æœŸé–“çµ‚äº†
  support_advisor: string,      // æ‹…å½“ç›¸è«‡æ”¯æ´å°‚é–€å“¡
  status: string,               // ã€Œä½œæˆä¸­ã€ã€Œç¢ºå®šã€ã€Œå®Ÿæ–½ä¸­ã€ã€Œçµ‚äº†ã€
  created_at: datetime,
  updated_at: datetime
})

// ============================================================
// Assessment (ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆ) ãƒãƒ¼ãƒ‰
// ============================================================
(a:Assessment {
  assessment_id: string,        // UUID
  interview_date: date,         // é¢è«‡æ—¥
  interview_content: string,    // ãƒ’ã‚¢ãƒªãƒ³ã‚°å†…å®¹ï¼ˆè‡ªç”±è¨˜è¿°ï¼‰

  // LLMåˆ†æçµæœ
  analyzed_needs: list,         // åˆ†æã•ã‚ŒãŸãƒ‹ãƒ¼ã‚ºï¼ˆé…åˆ—ï¼‰
  strengths: list,              // å¼·ã¿
  challenges: list,             // èª²é¡Œ
  preferences: list,            // æœ¬äººã®å¸Œæœ›
  family_wishes: list,          // å®¶æ—ã®å¸Œæœ›

  // ICFãƒ¢ãƒ‡ãƒ«åˆ†é¡
  body_functions: string,       // å¿ƒèº«æ©Ÿèƒ½
  activities: string,           // æ´»å‹•
  participation: string,        // å‚åŠ 
  environmental_factors: string,// ç’°å¢ƒå› å­
  personal_factors: string,     // å€‹äººå› å­

  created_at: datetime,
  updated_at: datetime
})

// ============================================================
// Goal (ç›®æ¨™) ãƒãƒ¼ãƒ‰
// ============================================================
(g:Goal {
  goal_id: string,              // UUID
  goal_type: string,            // ã€Œé•·æœŸã€ã€ŒçŸ­æœŸã€
  goal_text: string,            // ç›®æ¨™å†…å®¹
  goal_reason: string,          // è¨­å®šç†ç”±
  evaluation_period: string,    // è©•ä¾¡æœŸé–“
  evaluation_method: string,    // è©•ä¾¡æ–¹æ³•

  // SMARTè©•ä¾¡
  is_specific: boolean,         // å…·ä½“çš„ã‹
  is_measurable: boolean,       // æ¸¬å®šå¯èƒ½ã‹
  is_achievable: boolean,       // é”æˆå¯èƒ½ã‹
  is_relevant: boolean,         // é–¢é€£æ€§ãŒã‚ã‚‹ã‹
  is_time_bound: boolean,       // æœŸé™ãŒã‚ã‚‹ã‹
  smart_score: float,           // SMARTå¾—ç‚¹ï¼ˆ0-1ï¼‰

  priority: integer,            // å„ªå…ˆåº¦ï¼ˆ1-5ï¼‰
  status: string,               // ã€Œè¨­å®šã€ã€Œå®Ÿæ–½ä¸­ã€ã€Œé”æˆã€ã€Œè¦‹ç›´ã—ã€
  created_at: datetime,
  updated_at: datetime
})

// ============================================================
// ServiceNeed (ã‚µãƒ¼ãƒ“ã‚¹æä¾›å†…å®¹) ãƒãƒ¼ãƒ‰
// ============================================================
(s:ServiceNeed {
  service_need_id: string,      // UUID
  service_type: string,         // ã‚µãƒ¼ãƒ“ã‚¹ç¨®åˆ¥
  service_content: string,      // ã‚µãƒ¼ãƒ“ã‚¹å†…å®¹
  frequency: string,            // é »åº¦ï¼ˆä¾‹: é€±3å›ã€æœˆ20æ—¥ï¼‰
  duration: string,             // æ™‚é–“ï¼ˆä¾‹: 1æ—¥4æ™‚é–“ï¼‰

  // é€±é–“ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
  schedule_monday: string,
  schedule_tuesday: string,
  schedule_wednesday: string,
  schedule_thursday: string,
  schedule_friday: string,
  schedule_saturday: string,
  schedule_sunday: string,

  start_date: date,             // é–‹å§‹äºˆå®šæ—¥
  support_notes: string,        // ç•™æ„äº‹é …
  created_at: datetime,
  updated_at: datetime
})

// ============================================================
// Relationships
// ============================================================

// User has Plan
(User)-[:HAS_PLAN]->(Plan)

// Plan based on Assessment
(Plan)-[:BASED_ON]->(Assessment)

// Plan has Goals
(Plan)-[:HAS_LONG_TERM_GOAL]->(Goal {goal_type: "é•·æœŸ"})
(Plan)-[:HAS_SHORT_TERM_GOAL]->(Goal {goal_type: "çŸ­æœŸ"})

// Plan includes ServiceNeeds
(Plan)-[:INCLUDES_SERVICE]->(ServiceNeed)

// ServiceNeed provided by Facility
(ServiceNeed)-[:PROVIDED_BY]->(Facility)

// Goal achieved through ServiceNeed
(Goal)-[:ACHIEVED_THROUGH]->(ServiceNeed)
```

## API Endpoints

### User Management

```python
# åˆ©ç”¨è€…ä¸€è¦§å–å¾—
GET /api/users
Response: List[User]

# åˆ©ç”¨è€…è©³ç´°å–å¾—
GET /api/users/{user_id}
Response: User

# åˆ©ç”¨è€…ä½œæˆ
POST /api/users
Request: {
  "name": "å±±ç”°å¤ªéƒ",
  "birth_date": "1980-05-15",
  "disability_type": "çŸ¥çš„éšœå®³",
  ...
}
Response: User

# åˆ©ç”¨è€…æ›´æ–°
PUT /api/users/{user_id}
Request: User (partial update allowed)
Response: User

# åˆ©ç”¨è€…å‰Šé™¤
DELETE /api/users/{user_id}
Response: {"status": "deleted"}
```

### Assessment & Needs Analysis

```python
# ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆä½œæˆï¼ˆLLMåˆ†æå«ã‚€ï¼‰
POST /api/assessments
Request: {
  "user_id": "uuid",
  "interview_date": "2025-10-31",
  "interview_content": "45æ­³ç”·æ€§ã€çŸ¥çš„éšœå®³ï¼ˆé‡åº¦ï¼‰...",
  "analyze": true  # LLMåˆ†æã‚’å®Ÿè¡Œ
}
Response: {
  "assessment": Assessment,
  "llm_analysis": {
    "analyzed_needs": ["è‡ªå·±å®Ÿç¾", "ç¤¾ä¼šå‚åŠ ", "å¥åº·ç®¡ç†"],
    "strengths": ["ä½œæ¥­æ„æ¬²ãŒã‚ã‚‹", "ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³å¯èƒ½"],
    "challenges": ["ä½“åŠ›çš„åˆ¶ç´„", "é•·æ™‚é–“ä½œæ¥­å›°é›£"],
    "recommendations": ["çŸ­æ™‚é–“ä½œæ¥­ã‹ã‚‰é–‹å§‹", "æ®µéšçš„ãªæ”¯æ´"]
  }
}

# ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆå–å¾—
GET /api/assessments/{assessment_id}
Response: Assessment

# ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆæ›´æ–°
PUT /api/assessments/{assessment_id}
Request: Assessment (partial)
Response: Assessment
```

### Goal Setting

```python
# ç›®æ¨™ææ¡ˆï¼ˆLLMç”Ÿæˆï¼‰
POST /api/goals/suggest
Request: {
  "assessment_id": "uuid",
  "goal_type": "é•·æœŸ"  # or "çŸ­æœŸ"
}
Response: {
  "suggested_goals": [
    {
      "goal_text": "é€±3æ—¥ã€åˆå‰ä¸­ã®è»½ä½œæ¥­ã§åå…¥ã‚’å¾—ã‚‹",
      "goal_reason": "æœ¬äººã®ä½“åŠ›ã¨å¸Œæœ›ã‚’è€ƒæ…®",
      "smart_score": 0.85,
      "confidence": 0.9
    },
    ...
  ]
}

# ç›®æ¨™ä½œæˆ
POST /api/goals
Request: Goal
Response: Goal

# ç›®æ¨™è©•ä¾¡ï¼ˆSMARTåˆ†æï¼‰
POST /api/goals/{goal_id}/evaluate
Response: {
  "smart_analysis": {
    "is_specific": true,
    "is_measurable": true,
    "is_achievable": true,
    "is_relevant": true,
    "is_time_bound": false,
    "smart_score": 0.8,
    "suggestions": ["è©•ä¾¡æœŸé–“ã‚’æ˜ç¤ºã—ã¦ãã ã•ã„"]
  }
}
```

### Service Planning

```python
# ã‚µãƒ¼ãƒ“ã‚¹ææ¡ˆï¼ˆLLMç”Ÿæˆï¼‰
POST /api/services/suggest
Request: {
  "user_id": "uuid",
  "goal_ids": ["uuid1", "uuid2"],
  "preferences": {
    "location": "å°å€‰åŒ—åŒº",
    "transportation": true
  }
}
Response: {
  "suggested_services": [
    {
      "service_type": "å°±åŠ´ç¶™ç¶šæ”¯æ´Bå‹",
      "frequency": "é€±3æ—¥",
      "duration": "åˆå‰ä¸­ï¼ˆ9:00-12:00ï¼‰",
      "recommended_facilities": [Facility, ...],
      "rationale": "ä½“åŠ›çš„åˆ¶ç´„ã‚’è€ƒæ…®ã—ãŸçŸ­æ™‚é–“åˆ©ç”¨"
    },
    ...
  ],
  "weekly_schedule": {
    "monday": {...},
    "tuesday": {...},
    ...
  }
}

# ã‚µãƒ¼ãƒ“ã‚¹å†…å®¹ä½œæˆ
POST /api/services
Request: ServiceNeed
Response: ServiceNeed
```

### Plan Management

```python
# è¨ˆç”»æ›¸ä½œæˆï¼ˆçµ±åˆï¼‰
POST /api/plans
Request: {
  "user_id": "uuid",
  "assessment_id": "uuid",
  "goal_ids": ["uuid1", "uuid2"],
  "service_ids": ["uuid1", "uuid2"],
  "plan_type": "åˆå›"
}
Response: Plan

# è¨ˆç”»æ›¸å–å¾—
GET /api/plans/{plan_id}
Response: {
  "plan": Plan,
  "user": User,
  "assessment": Assessment,
  "goals": [Goal, ...],
  "services": [ServiceNeed, ...]
}

# è¨ˆç”»æ›¸æ›´æ–°
PUT /api/plans/{plan_id}
Request: Plan (partial)
Response: Plan
```

### Document Generation

```python
# è¨ˆç”»æ›¸ï¼ˆæ§˜å¼1ï¼‰ç”Ÿæˆ
POST /api/documents/plan-form1
Request: {
  "plan_id": "uuid",
  "format": "docx"  # or "pdf"
}
Response: {
  "file_url": "/downloads/plan_form1_20251031.docx",
  "file_size": 45678
}

# é€±é–“è¨ˆç”»è¡¨ï¼ˆæ§˜å¼5ï¼‰ç”Ÿæˆ
POST /api/documents/plan-form5
Request: {
  "plan_id": "uuid",
  "format": "pdf"
}
Response: {
  "file_url": "/downloads/plan_form5_20251031.pdf",
  "file_size": 23456
}
```

## LLM Prompting Strategies

### Needs Analysis Prompt

```python
NEEDS_ANALYSIS_PROMPT = """ã‚ãªãŸã¯çµŒé¨“è±Šå¯Œãªè¨ˆç”»ç›¸è«‡æ”¯æ´å°‚é–€å“¡ã§ã™ã€‚
ä»¥ä¸‹ã®ãƒ’ã‚¢ãƒªãƒ³ã‚°å†…å®¹ã‹ã‚‰ã€åˆ©ç”¨è€…ã®æ½œåœ¨çš„ãªãƒ‹ãƒ¼ã‚ºã‚’åˆ†æã—ã¦ãã ã•ã„ã€‚

ã€ãƒ’ã‚¢ãƒªãƒ³ã‚°å†…å®¹ã€‘
{interview_content}

ã€åˆ†æã®è¦³ç‚¹ã€‘
1. ICFãƒ¢ãƒ‡ãƒ«ã«åŸºã¥ãåˆ†é¡
   - å¿ƒèº«æ©Ÿèƒ½ï¼ˆbody functionsï¼‰
   - æ´»å‹•ï¼ˆactivitiesï¼‰
   - å‚åŠ ï¼ˆparticipationï¼‰
   - ç’°å¢ƒå› å­ï¼ˆenvironmental factorsï¼‰
   - å€‹äººå› å­ï¼ˆpersonal factorsï¼‰

2. æ§‹é€ åŒ–
   - æœ¬äººã®å¸Œæœ›
   - å®¶æ—ã®å¸Œæœ›
   - æœ¬äººã®å¼·ã¿
   - æ”¯æ´ãŒå¿…è¦ãªèª²é¡Œ
   - æ½œåœ¨çš„ãªãƒ‹ãƒ¼ã‚º

JSONå½¢å¼ã§è¿”ç­”ã—ã¦ãã ã•ã„ï¼š
{
  "analyzed_needs": ["ãƒ‹ãƒ¼ã‚º1", "ãƒ‹ãƒ¼ã‚º2", ...],
  "strengths": ["å¼·ã¿1", "å¼·ã¿2", ...],
  "challenges": ["èª²é¡Œ1", "èª²é¡Œ2", ...],
  "preferences": ["æœ¬äººå¸Œæœ›1", "æœ¬äººå¸Œæœ›2", ...],
  "family_wishes": ["å®¶æ—å¸Œæœ›1", "å®¶æ—å¸Œæœ›2", ...],
  "icf_classification": {
    "body_functions": "...",
    "activities": "...",
    "participation": "...",
    "environmental_factors": "...",
    "personal_factors": "..."
  }
}
"""
```

### Goal Setting Prompt

```python
GOAL_SETTING_PROMPT = """ã‚ãªãŸã¯è¨ˆç”»ç›¸è«‡æ”¯æ´å°‚é–€å“¡ã§ã™ã€‚
ä»¥ä¸‹ã®ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆçµæœã‹ã‚‰ã€SMARTåŸå‰‡ã«åŸºã¥ã„ãŸç›®æ¨™ã‚’ææ¡ˆã—ã¦ãã ã•ã„ã€‚

ã€ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆçµæœã€‘
{assessment_summary}

ã€ç›®æ¨™ç¨®åˆ¥ã€‘
{goal_type}  # "é•·æœŸç›®æ¨™" or "çŸ­æœŸç›®æ¨™"

ã€SMARTåŸå‰‡ã€‘
- Specific (å…·ä½“çš„)
- Measurable (æ¸¬å®šå¯èƒ½)
- Achievable (é”æˆå¯èƒ½)
- Relevant (é–¢é€£æ€§)
- Time-bound (æœŸé™ä»˜ã)

ã€å‡ºåŠ›å½¢å¼ã€‘
JSONå½¢å¼ã§3-5å€‹ã®ç›®æ¨™æ¡ˆã‚’ææ¡ˆã—ã¦ãã ã•ã„ï¼š
{
  "goals": [
    {
      "goal_text": "ç›®æ¨™ã®å†…å®¹",
      "goal_reason": "ã“ã®ç›®æ¨™ã‚’è¨­å®šã™ã‚‹ç†ç”±",
      "evaluation_period": "è©•ä¾¡æœŸé–“",
      "evaluation_method": "è©•ä¾¡æ–¹æ³•",
      "smart_evaluation": {
        "is_specific": true/false,
        "is_measurable": true/false,
        "is_achievable": true/false,
        "is_relevant": true/false,
        "is_time_bound": true/false,
        "score": 0.0-1.0
      },
      "confidence": 0.0-1.0
    },
    ...
  ]
}
"""
```

### Service Planning Prompt

```python
SERVICE_PLANNING_PROMPT = """ã‚ãªãŸã¯éšœå®³ç¦ç¥‰ã‚µãƒ¼ãƒ“ã‚¹ã«ç²¾é€šã—ãŸè¨ˆç”»ç›¸è«‡æ”¯æ´å°‚é–€å“¡ã§ã™ã€‚
ä»¥ä¸‹ã®æƒ…å ±ã‹ã‚‰ã€æœ€é©ãªã‚µãƒ¼ãƒ“ã‚¹çµ„ã¿åˆã‚ã›ã‚’ææ¡ˆã—ã¦ãã ã•ã„ã€‚

ã€åˆ©ç”¨è€…æƒ…å ±ã€‘
{user_summary}

ã€è¨­å®šã•ã‚ŒãŸç›®æ¨™ã€‘
{goals_summary}

ã€åˆ©ç”¨å¯èƒ½ãªæ–½è¨­ã€‘
{available_facilities}

ã€ææ¡ˆã—ã¦ãã ã•ã„ã€‘
1. å¿…è¦ãªã‚µãƒ¼ãƒ“ã‚¹ç¨®åˆ¥
2. å„ã‚µãƒ¼ãƒ“ã‚¹ã®åˆ©ç”¨é »åº¦ãƒ»æ™‚é–“
3. å…·ä½“çš„ãªäº‹æ¥­æ‰€å€™è£œï¼ˆæ–½è¨­ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰ï¼‰
4. é€±é–“ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«æ¡ˆ
5. æ”¯æ´ä¸Šã®ç•™æ„äº‹é …

JSONå½¢å¼ã§è¿”ç­”ã—ã¦ãã ã•ã„ï¼š
{
  "services": [
    {
      "service_type": "ã‚µãƒ¼ãƒ“ã‚¹ç¨®åˆ¥",
      "service_content": "å…·ä½“çš„å†…å®¹",
      "frequency": "é »åº¦",
      "duration": "æ™‚é–“",
      "recommended_facilities": ["facility_id1", ...],
      "rationale": "é¸å®šç†ç”±"
    },
    ...
  ],
  "weekly_schedule": {
    "monday": {"morning": "...", "afternoon": "...", "evening": "..."},
    "tuesday": {...},
    ...
  },
  "support_notes": "æ”¯æ´ä¸Šã®ç•™æ„äº‹é …"
}
"""
```

## Frontend UI Flow

### Page 1: æ–½è¨­æ¤œç´¢ï¼ˆæ—¢å­˜ï¼‰
- æ—¢å­˜ã®ãƒãƒ£ãƒƒãƒˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ç¶­æŒ

### Page 2: åˆ©ç”¨è€…ç®¡ç†
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åˆ©ç”¨è€…ä¸€è¦§                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [+ æ–°è¦ç™»éŒ²]         [æ¤œç´¢: ______ ğŸ”] â”‚
â”‚                                        â”‚
â”‚  åå‰       å¹´é½¢  éšœå®³ç¨®åˆ¥  æœ€çµ‚æ›´æ–°  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  å±±ç”°å¤ªéƒ   45    çŸ¥çš„      2025-10-30â”‚
â”‚  éˆ´æœ¨èŠ±å­   32    ç²¾ç¥      2025-10-28â”‚
â”‚  ...                                   â”‚
â”‚                                        â”‚
â”‚  [è©³ç´°] [ç·¨é›†] [è¨ˆç”»æ›¸ä½œæˆ]           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Page 3: ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆãƒ»ãƒ‹ãƒ¼ã‚ºåˆ†æ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åˆ©ç”¨è€…: å±±ç”°å¤ªéƒ (45æ­³)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é¢è«‡æ—¥: [2025-10-31]                 â”‚
â”‚                                        â”‚
â”‚  ãƒ’ã‚¢ãƒªãƒ³ã‚°å†…å®¹:                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ 45æ­³ç”·æ€§ã€çŸ¥çš„éšœå®³ï¼ˆé‡åº¦ï¼‰ã€‚     â”‚ â”‚
â”‚  â”‚ ã‚°ãƒ«ãƒ¼ãƒ—ãƒ›ãƒ¼ãƒ å…¥å±…å¸Œæœ›ã€‚         â”‚ â”‚
â”‚  â”‚ æ—¥ä¸­ã¯ä½œæ¥­ã‚’ã—ãŸã„ãŒã€ä½“åŠ›çš„ã« â”‚ â”‚
â”‚  â”‚ é•·æ™‚é–“ã¯é›£ã—ã„...                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                        â”‚
â”‚  [AIã§åˆ†æ]                            â”‚
â”‚                                        â”‚
â”‚  â•â• åˆ†æçµæœ â•â•                       â”‚
â”‚  âœ“ æ½œåœ¨çš„ãƒ‹ãƒ¼ã‚º                       â”‚
â”‚    â€¢ è‡ªå·±å®Ÿç¾                          â”‚
â”‚    â€¢ ç¤¾ä¼šå‚åŠ                           â”‚
â”‚    â€¢ å¥åº·ç®¡ç†                          â”‚
â”‚                                        â”‚
â”‚  âœ“ æœ¬äººã®å¼·ã¿                         â”‚
â”‚    â€¢ ä½œæ¥­æ„æ¬²ãŒã‚ã‚‹                    â”‚
â”‚    â€¢ ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³å¯èƒ½            â”‚
â”‚                                        â”‚
â”‚  âœ“ æ”¯æ´ãŒå¿…è¦ãªèª²é¡Œ                   â”‚
â”‚    â€¢ ä½“åŠ›çš„åˆ¶ç´„                        â”‚
â”‚    â€¢ é•·æ™‚é–“ä½œæ¥­å›°é›£                    â”‚
â”‚                                        â”‚
â”‚  [æ¬¡ã¸: ç›®æ¨™è¨­å®š]                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Page 4: ç›®æ¨™è¨­å®šãƒ»ã‚µãƒ¼ãƒ“ã‚¹èª¿æ•´
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç›®æ¨™è¨­å®š                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [AIã§ç›®æ¨™ææ¡ˆ]                        â”‚
â”‚                                        â”‚
â”‚  â•â• é•·æœŸç›®æ¨™æ¡ˆ â•â•                     â”‚
â”‚  1. é€±3æ—¥ã€åˆå‰ä¸­ã®è»½ä½œæ¥­ã§åå…¥ã‚’å¾—ã‚‹â”‚
â”‚     SMARTè©•ä¾¡: â˜…â˜…â˜…â˜…â˜† (0.85)       â”‚
â”‚     [æ¡ç”¨] [ç·¨é›†]                      â”‚
â”‚                                        â”‚
â”‚  2. ã‚°ãƒ«ãƒ¼ãƒ—ãƒ›ãƒ¼ãƒ ã§è‡ªç«‹ã—ãŸç”Ÿæ´»ã‚’é€ã‚‹â”‚
â”‚     SMARTè©•ä¾¡: â˜…â˜…â˜…â˜†â˜† (0.70)       â”‚
â”‚     [æ¡ç”¨] [ç·¨é›†]                      â”‚
â”‚                                        â”‚
â”‚  â•â• çŸ­æœŸç›®æ¨™æ¡ˆ â•â•                     â”‚
â”‚  ...                                   â”‚
â”‚                                        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                        â”‚
â”‚  ã‚µãƒ¼ãƒ“ã‚¹ææ¡ˆ                          â”‚
â”‚  [AIã§ã‚µãƒ¼ãƒ“ã‚¹ææ¡ˆ]                    â”‚
â”‚                                        â”‚
â”‚  â•â• æ¨å¥¨ã‚µãƒ¼ãƒ“ã‚¹ â•â•                   â”‚
â”‚  âœ“ å°±åŠ´ç¶™ç¶šæ”¯æ´Bå‹                    â”‚
â”‚    é »åº¦: é€±3æ—¥ï¼ˆæœˆãƒ»æ°´ãƒ»é‡‘ï¼‰          â”‚
â”‚    æ™‚é–“: åˆå‰ä¸­ï¼ˆ9:00-12:00ï¼‰         â”‚
â”‚    å€™è£œäº‹æ¥­æ‰€: [Aä½œæ¥­æ‰€] [Bä½œæ¥­æ‰€]    â”‚
â”‚                                        â”‚
â”‚  âœ“ å…±åŒç”Ÿæ´»æ´åŠ©                        â”‚
â”‚    å€™è£œäº‹æ¥­æ‰€: [Cã‚°ãƒ«ãƒ¼ãƒ—ãƒ›ãƒ¼ãƒ ]      â”‚
â”‚                                        â”‚
â”‚  é€±é–“ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«:                    â”‚
â”‚  [ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º]               â”‚
â”‚                                        â”‚
â”‚  [è¨ˆç”»æ›¸ç”Ÿæˆ]                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Page 5: è¨ˆç”»æ›¸ç”Ÿæˆãƒ»å‡ºåŠ›
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¨ˆç”»æ›¸ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [æ§˜å¼1: ã‚µãƒ¼ãƒ“ã‚¹ç­‰åˆ©ç”¨è¨ˆç”»æ›¸]        â”‚
â”‚  [æ§˜å¼5: é€±é–“è¨ˆç”»è¡¨]                  â”‚
â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ã‚µãƒ¼ãƒ“ã‚¹ç­‰åˆ©ç”¨è¨ˆç”»æ›¸               â”‚ â”‚
â”‚  â”‚                                    â”‚ â”‚
â”‚  â”‚ åˆ©ç”¨è€…æ°å: å±±ç”°å¤ªéƒ               â”‚ â”‚
â”‚  â”‚ éšœå®³ç¨®åˆ¥: çŸ¥çš„éšœå®³                 â”‚ â”‚
â”‚  â”‚                                    â”‚ â”‚
â”‚  â”‚ ã€é•·æœŸç›®æ¨™ã€‘                       â”‚ â”‚
â”‚  â”‚ é€±3æ—¥ã€åˆå‰ä¸­ã®è»½ä½œæ¥­ã§åå…¥ã‚’å¾—ã‚‹ â”‚ â”‚
â”‚  â”‚                                    â”‚ â”‚
â”‚  â”‚ ã€çŸ­æœŸç›®æ¨™ã€‘                       â”‚ â”‚
â”‚  â”‚ ...                                 â”‚ â”‚
â”‚  â”‚                                    â”‚ â”‚
â”‚  â”‚ ã€ã‚µãƒ¼ãƒ“ã‚¹å†…å®¹ã€‘                   â”‚ â”‚
â”‚  â”‚ ...                                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                        â”‚
â”‚  [Wordå‡ºåŠ›] [PDFå‡ºåŠ›] [ç·¨é›†]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Testing Strategy

### Unit Tests
- `/tests/test_user_api.py` - åˆ©ç”¨è€…API
- `/tests/test_assessment_ai.py` - ãƒ‹ãƒ¼ã‚ºåˆ†æLLM
- `/tests/test_goal_generator.py` - ç›®æ¨™ç”ŸæˆLLM
- `/tests/test_document_generator.py` - ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç”Ÿæˆ

### Integration Tests
- `/tests/test_plan_creation_flow.py` - è¨ˆç”»æ›¸ä½œæˆãƒ•ãƒ­ãƒ¼å…¨ä½“
- `/tests/test_llm_quality.py` - LLMç”Ÿæˆå“è³ªè©•ä¾¡

### E2E Tests
- Streamlit UIæ“ä½œãƒ†ã‚¹ãƒˆï¼ˆPlaywrightï¼‰
- å®Œå…¨ãªè¨ˆç”»æ›¸ä½œæˆã‚·ãƒŠãƒªã‚ª

## Implementation Phases

### Phase 1: ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«è¨­è¨ˆï¼ˆ1-2æ—¥ï¼‰
- Neo4jã‚¹ã‚­ãƒ¼ãƒæ‹¡å¼µå®Ÿè£…
- ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆä½œæˆ
- ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æŠ•å…¥

### Phase 2: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIï¼ˆ3-4æ—¥ï¼‰
- åˆ©ç”¨è€…ç®¡ç†APIå®Ÿè£…
- ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆAPI + LLMçµ±åˆ
- ç›®æ¨™è¨­å®šAPI + LLMçµ±åˆ
- ã‚µãƒ¼ãƒ“ã‚¹èª¿æ•´API + LLMçµ±åˆ
- è¨ˆç”»æ›¸ç®¡ç†APIå®Ÿè£…

### Phase 3: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç”Ÿæˆï¼ˆ2æ—¥ï¼‰
- Wordãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä½œæˆï¼ˆæ§˜å¼1ã€æ§˜å¼5ï¼‰
- python-docxçµ±åˆ
- PDFç”Ÿæˆï¼ˆreportlabçµ±åˆï¼‰

### Phase 4: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆ3-4æ—¥ï¼‰
- Streamlitãƒãƒ«ãƒãƒšãƒ¼ã‚¸åŒ–
- åˆ©ç”¨è€…ç®¡ç†UI
- ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆãƒ»ç›®æ¨™è¨­å®šUI
- è¨ˆç”»æ›¸ç”ŸæˆUI

### Phase 5: LLMãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæœ€é©åŒ–ï¼ˆ1-2æ—¥ï¼‰
- ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ã‚¹ãƒˆã¨æ”¹å–„
- ç”Ÿæˆå“è³ªè©•ä¾¡
- ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯åæ˜ 

### Phase 6: ãƒ†ã‚¹ãƒˆãƒ»å“è³ªä¿è¨¼ï¼ˆ1-2æ—¥ï¼‰
- çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿæ–½
- E2Eãƒ†ã‚¹ãƒˆå®Ÿæ–½
- ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ
